# ü§ñ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞ 2248

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/workspace/
‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ bot.py                  # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞—Å–∞–¥ –±–æ—Ç–∞ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
‚îú‚îÄ‚îÄ ui.py                   # –ö–æ–Ω—Å–æ–ª—å–Ω–æ–µ –º–µ–Ω—é –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥
‚îú‚îÄ‚îÄ config_manager.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π, –ø—Ä–æ–±–ª–µ–º–Ω—ã–º–∏ –∫–ª–µ—Ç–∫–∞–º–∏, –ø–ª–æ—Ö–∏–º–∏ —Ö–æ–¥–∞–º–∏
‚îú‚îÄ‚îÄ screen_processor.py     # –†–∞–±–æ—Ç–∞ —Å —ç–∫—Ä–∞–Ω–æ–º, ADB, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –∫—Ä–æ–ø—ã
‚îú‚îÄ‚îÄ game_logic.py           # –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏, –ø–æ–∏—Å–∫ —Ü–µ–ø–æ—á–µ–∫
‚îú‚îÄ‚îÄ heuristics_2248.py      # –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ —Ö–æ–¥–æ–≤
‚îú‚îÄ‚îÄ game_runner.py          # –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
‚îú‚îÄ‚îÄ input_controller.py     # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–≤–æ–¥–∞ (—Ç–∞–ø—ã/—Å–≤–∞–π–ø—ã)
‚îú‚îÄ‚îÄ end_game_handler.py     # –û–±—Ä–∞–±–æ—Ç–∫–∞ —ç–∫—Ä–∞–Ω–æ–≤ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã
‚îú‚îÄ‚îÄ ad_detector_2248.py     # –î–µ—Ç–µ–∫—Ç–æ—Ä —Ä–µ–∫–ª–∞–º—ã –∏ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ color_trainer.py        # –û–±—É—á–µ–Ω–∏–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—é —Ü–≤–µ—Ç–æ–≤
‚îî‚îÄ‚îÄ constants.py            # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
```

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –†–∞–±–æ—á–∏–π ADB –∏ –æ–¥–Ω–æ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ/—ç–º—É–ª—è—Ç–æ—Ä
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ `EVENT_DEV`, `X_MIN/X_MAX/Y_MIN/Y_MAX` –≤ `constants.py`
- –ò–≥—Ä–∞ 2248 –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–∞ –∏–≥—Ä–æ–≤–æ–º –ø–æ–ª–µ (–Ω–µ –≤ –º–µ–Ω—é)

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –¥–∞–Ω–Ω—ã–µ
1. **config.json** –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
   - `calibrated: True` –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤
   - `grid`: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–æ–≤ 5√ó4 –∫–ª–µ—Ç–æ–∫ (—á–µ—Ä–µ–∑ –∞–≤—Ç–æ/—Ä—É—á–Ω—É—é –∫–∞–ª–∏–±—Ä–æ–≤–∫—É)
   - `colors`: —Å–ª–æ–≤–∞—Ä—å `"—á–∏—Å–ª–æ" | "adv" ‚Üí [ [r,g,b], ... ]`

2. **problem_cells.json** –∏ **bad_moves.json** ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã, –Ω–æ –ø–æ–ª–µ–∑–Ω—ã:
   - `problem_cells`: –∫–æ–ø—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `GameLogic.remember_problem_cell`
   - `bad_moves`: —Ö—Ä–∞–Ω—è—Ç—Å—è —á–µ—Ä–µ–∑ `ConfigManager.bad_moves`, –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Ö–æ–¥–∞—Ö

3. **–ü–∞–ø–∫–∏**:
   - `cells/` ‚Äî –¥–ª—è `cell_r_c.png`
   - `moves/` ‚Äî –¥–ª—è `move_N.png`, `after_move_N.png`
   - `problem_cells/` ‚Äî –∫–æ–ø–∏–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫
   - `end_screens/` —Å win/lose —à–∞–±–ª–æ–Ω–∞–º–∏ –∏ `end_button_template.png`

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ (—Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏)

#### **main.py**
- –°–æ–∑–¥–∞—ë—Ç `Auto2248Bot()` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `bot.show_menu()`

#### **bot.py (Auto2248Bot)**
- –ü–æ–¥–Ω–∏–º–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: `ConfigManager`, `ScreenProcessor`, `InputController`, `GameLogic`, `ColorTrainer`, `EndGameHandler`, `EndGameAdDetector2248`, `GameRunner`, `UI`
- –°–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å—ë –º–µ–∂–¥—É —Å–æ–±–æ–π (`set_ad_detector`, –ø–µ—Ä–µ–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç—ã –≤ `GameRunner`, `UI`)
- –ù–∞—Ä—É–∂—É –¥–∞—ë—Ç –º–µ—Ç–æ–¥—ã: `show_menu`, `run_auto_game`, `check_adb`, `take_screenshot`, `show_problem_cells` –∏ —Ç.–ø.

#### **ui.py**
- –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –º–µ–Ω—é –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥
- –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é:
  - 4 ‚Äî –æ–±—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ `ColorTrainer.learn_colors_simple()`
  - 5 ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∏ –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –¥–æ—Å–∫—É (`take_screenshot` ‚Üí `crop_cells_from_screen` ‚Üí `GameLogic.recognize_board_with_confidence` ‚Üí `print_board`)
  - 6 ‚Äî `bot.run_auto_game()` ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –≤ `GameRunner`
  - 8 ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç `bot.show_problem_cells()` (–≤—ã–≤–æ–¥ `ConfigManager.problem_cells`)

#### **config_manager.py**
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –¥–ª—è:
  - `config` (grid, colors, thresholds, ...)
  - `problem_cells` (–∑–∞–≥—Ä—É–∑–∫–∞/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
  - `bad_moves` (–∑–∞–≥—Ä—É–∑–∫–∞/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
  - **–ù–æ–≤—ã–π –º–µ—Ç–æ–¥**: `show_problem_cells()` ‚Äî –∫—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫

#### **screen_processor.py**
- –í—Å—ë –ø–æ —ç–∫—Ä–∞–Ω—É/ADB: —Å–∫—Ä–∏–Ω—ã, –∫—Ä–æ–ø—ã, –¥–æ—Å—Ç–∞–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∫–ª–µ—Ç–∫–∏

#### **game_logic.py**
- –î–µ—Ä–∂–∏—Ç `board` 5√ó4
- –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –¥–æ—Å–∫—É (`recognize_board_with_confidence`)
- –°–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–ª–µ—Ç–∫–∏ (`remember_problem_cell` ‚Üí `config_manager.problem_cells`)
- –ò—â–µ—Ç —Ü–µ–ø–æ—á–∫–∏ (`find_all_chains`, `_filter_chains`, `is_valid_chain`)
- –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ü–µ–ø–æ—á–∫–∏ —á–µ—Ä–µ–∑ —ç–≤—Ä–∏—Å—Ç–∏–∫—É (`evaluate_chain_smart`)
- –í—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–π —Ö–æ–¥ (`find_best_chain_smart`), —É—á–∏—Ç—ã–≤–∞—è `bad_moves`
- –°–∏–º—É–ª–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è (`simulate_board_after_move`)
- –ó–∞–ø–æ–º–∏–Ω–∞–µ—Ç –ø–ª–æ—Ö–∏–µ —Ö–æ–¥—ã (`remember_bad_move` ‚Üí `bad_moves.json`)

#### **heuristics_2248.py**
- –ü–æ–¥–∫–ª—é—á–µ–Ω –≤ `GameLogic`:
  ```python
  from heuristics_2248 import Heuristics2248

  class GameLogic:
      def __init__(...):
          ...
          self.heuristics = Heuristics2248(self)

      def evaluate_chain_smart(self, chain):
          return self.heuristics.evaluate_chain(chain)
  ```
- –¢–æ–≥–¥–∞ –≤–µ—Å—å –≤—ã–±–æ—Ä `best_chain`/`best_pair` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é —ç–≤—Ä–∏—Å—Ç–∏–∫—É, –∞ –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥

#### **game_runner.py**
- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∏–≥—Ä—ã:
  - –°–∫—Ä–∏–Ω ‚Üí –∫—Ä–æ–ø
  - `GameLogic.recognize_board_with_confidence`
  - `get_board_hash`, —Ä–∞–±–æ—Ç–∞ —Å `last_move_hash` / `current_move_attempts`
  - `find_best_chain_smart` ‚Üí `evaluate_chain_smart`/`Heuristics2248`
  - `InputController.perform_chain_swipe_mt`
  - `EndGameHandler.check_and_restart` + `EndGameAdDetector2248` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ö–æ–¥–æ–≤
  - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `print_board` –ø—Ä–∏ `show_board_each_move`

## ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç "—á—Ç–æ–±—ã –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ —Ä–∞–±–æ—Ç–∞–ª"

1. **–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∏ –æ–±—É—á–µ–Ω–∏–µ**
   - –ü—É–Ω–∫—Ç 1: ADB –æ–∫
   - –ü—É–Ω–∫—Ç 2/3/12: —Å–µ—Ç–∫–∞ (`grid`) –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∞ (–∏–ª–∏ `use_preset=True` –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ä–µ–∞–ª—å–Ω–æ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –∏–≥—Ä–æ–π)
   - –ü—É–Ω–∫—Ç 4: `ColorTrainer.learn_colors_simple()` –ø—Ä–æ–π–¥–µ–Ω –¥–æ –∫–æ–Ω—Ü–∞, `config["colors"]` –∑–∞–ø–æ–ª–Ω–µ–Ω, `calibrated=True`

2. **–≠–≤—Ä–∏—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**
   - –í `game_logic.py` –∏–º–ø–æ—Ä—Ç `Heuristics2248` –∏ –ø–æ–ª–µ `self.heuristics`
   - `evaluate_chain_smart` –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤ `self.heuristics.evaluate_chain`

3. **Runner –Ω–µ –ª–æ–º–∞–µ—Ç —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É**
   - `GameRunner.run_auto_game` –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±–ª–∏–∑–æ–∫ –∫ —Å—Ç–∞—Ä–æ–º—É `GameLogic.run_auto_game`
   - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–≤–∞–π–ø–∞ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–æ—Å–∫—É –∏ `last_move_hash` —á–µ—Ä–µ–∑ ¬´after_move¬ª —Å–∫—Ä–∏–Ω

4. **–û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º –∏ —Ö—Ä–µ–Ω–æ–≤–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è**
   - `remember_problem_cell` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–∏—à–µ—Ç –≤ `ConfigManager.problem_cells`
   - –ü—É–Ω–∫—Ç 8 –º–µ–Ω—é –≤—ã–∑—ã–≤–∞–µ—Ç `bot.show_problem_cells()`, –∫–æ—Ç–æ—Ä—ã–π –∫—Ä–∞—Å–∏–≤–æ –ø–µ—á–∞—Ç–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫

5. **–†–∞–±–æ—Ç–∞ —Å —Ä–µ–∫–ª–∞–º–æ–π/–∫–æ–Ω—Ü–æ–º –∏–≥—Ä—ã**
   - `EndGameHandler` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç win/lose –ø–æ —à–∞–±–ª–æ–Ω–∞–º –≤ `end_screens/`
   - `EndGameAdDetector2248` –∑–∞–≥—Ä—É–∂–∞–µ—Ç `end_button_template.png` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–µ—Å—Ç–∞—Ö, –≥–¥–µ ¬´–≤–æ–æ–±—â–µ –Ω–µ—Ç —Ö–æ–¥–æ–≤¬ª

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ï—Å–ª–∏ –≤—Å–µ —ç—Ç–∏ –ø—É–Ω–∫—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:
- –±–æ—Ç –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ö–æ–¥ —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–Ω–∞
- –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —Å–µ—Ç–∫—É –∏ —á–∏—Å–ª–∞ (—Å —É—á—ë—Ç–æ–º —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è)
- –≤—ã–±–∏—Ä–∞–µ—Ç —Ö–æ–¥—ã —á–µ—Ä–µ–∑ –æ–¥–Ω—É —Ç–æ—á–∫—É ‚Äî `Heuristics2248.evaluate_chain` ‚Üí `find_best_chain_smart`
- –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç, –≥–¥–µ –æ–±–æ—Å—Ä–∞–ª—Å—è (problem_cells + bad_moves)
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–æ–Ω–µ—Ü —Ä–∞—É–Ω–¥–∞ –∏ —Ä–µ–∫–ª–∞–º—É

## üìå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π:
- –ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –í—Å–µ 12 –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, **–ø—É–Ω–∫—Ç 8 "–î–æ–æ–±—É—á–∏—Ç—å –Ω–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö"** —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–º—É –º–µ—Ç–æ–¥—É `show_problem_cells` –≤ `Auto2248Bot`
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ